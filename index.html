<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BotJahl – AI-chattbot för din hemsida</title>
  <meta name="description" content="BotJahl är en AI-chattbot som du enkelt bäddar in på din webbplats. Starta gratis i 14 dagar – plug-in & run.">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="site.css">
</head>
<body>

  <!-- NAV -->
  <nav>
    <div class="container row">
      <a href="index.html" class="brand" aria-label="BotJahl startsida">
        <svg viewBox="0 0 48 48" fill="none" aria-hidden="true">
          <rect x="4" y="6" width="40" height="30" rx="10" fill="url(#g1)"/>
          <path d="M16 28c6 4 10 4 16 0" stroke="rgba(10,15,31,.7)" stroke-width="3" stroke-linecap="round"/>
          <circle cx="19" cy="20" r="2.4" fill="#0a0f1f"/>
          <circle cx="29" cy="20" r="2.4" fill="#0a0f1f"/>
          <path d="M30 38l-6-4-6 4 2.5-6.5" fill="url(#g2)" opacity=".9"/>
          <defs>
            <linearGradient id="g1" x1="4" y1="6" x2="46" y2="36"><stop stop-color="#60a5fa"/><stop offset=".6" stop-color="#22d3ee"/><stop offset="1" stop-color="#a78bfa"/></linearGradient>
            <linearGradient id="g2" x1="18" y1="32" x2="30" y2="38"><stop stop-color="#22d3ee"/><stop offset="1" stop-color="#60a5fa"/></linearGradient>
          </defs>
        </svg>
        BotJahl
      </a>
      <div class="nav-links">
        <a href="#demo">Demo</a>
        <a href="#starta">Starta gratis</a>
        <a href="admin.html" class="btn secondary" aria-label="Öppna adminportalen">Admin</a>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero container">
    <div class="wrap">
      <div class="card glass">
        <span class="badge">Plug-in & run</span>
        <h1>AI-chattbot som svarar med ditt innehåll</h1>
        <p class="muted">Bädda in på din webbplats på några minuter. Träna boten med dina PDF:er, DOCX eller webbsidor. Starta gratis i 14 dagar – ingen kod krävs.</p>
        <div class="grid grid-2">
          <a class="btn primary" href="#starta">Starta gratis</a>
          <a class="btn ghost" href="admin.html">Logga in i portalen</a>
        </div>
      </div>
      <div class="card">
        <div class="feature"><span class="dot"></span><div><strong>Enkelt att installera</strong><div class="muted">Kopiera en färdig &lt;iframe&gt;-kod.</div></div></div>
        <div class="feature"><span class="dot"></span><div><strong>Tränas på ditt material</strong><div class="muted">Ladda upp dokument – vi indexerar automatiskt.</div></div></div>
        <div class="feature"><span class="dot"></span><div><strong>Byggd för företag</strong><div class="muted">Provperiod 14 dagar, trygg kortbetalning via Stripe.</div></div></div>
      </div>
    </div>
  </header>

  <!-- DEMO -->
  <section id="demo">
    <div class="container">
      <h2>Testa BotJahl direkt</h2>
      <p class="muted">Demot är kopplat till vår testkund. Fråga vad boten kan hjälpa till med.</p>
      <div class="iframe-wrapper glass">
        <iframe
          id="botjahl-demo"
          loading="lazy"
          referrerpolicy="no-referrer"
          sandbox="allow-scripts allow-forms allow-same-origin"
          title="BotJahl demo-chatt"
          aria-label="Inbäddad demo av BotJahl"
        ></iframe>
      </div>
    </div>
  </section>

  <!-- SIGNUP -->
  <section id="starta">
    <div class="container">
      <h2>Starta gratis i 14 dagar</h2>
      <div class="card glass">
        <form id="signup">
          <input name="name" placeholder="Företagsnamn" autocomplete="organization" required />
          <input name="websiteUrl" placeholder="Webbplats (https://… eller www.dittföretag.se)" inputmode="url" required />
          <input name="email" type="email" placeholder="E-post" autocomplete="email" required />
          <div class="grid grid-1-auto">
            <p class="muted">Du får ett kund-ID och en betalningslänk. Kodsnutten lämnas först när betalmetod är lagd.</p>
            <button class="btn primary" type="submit">Skapa min bot</button>
          </div>
        </form>
        <div id="signup-result"></div>
      </div>
    </div>
  </section>

  <!-- CONTACT -->
  <section>
    <div class="container">
      <h2>Frågor?</h2>
      <p class="muted">Maila oss: <a href="mailto:faijahl75@gmail.com">faijahl75@gmail.com</a> eller <a href="admin.html">logga in i portalen</a> om du redan är kund.</p>
    </div>
  </section>

  <footer>
    <div class="container">© 2025 BotJahl – Enkelt. Smart. Anpassat.</div>
  </footer>

  <script>
    // === API-resolver: ?api=… → window.BOTJAHL_API_BASE → config.json ===
    async function resolveApiBase(){
      const qs = new URLSearchParams(location.search);
      const fromQuery = qs.get("api");
      if (fromQuery) return fromQuery.replace(/\/+$/,"");

      if (window.BOTJAHL_API_BASE) {
        return String(window.BOTJAHL_API_BASE).replace(/\/+$/,"");
      }

      try{
        const r = await fetch("./config.json", { cache:"no-store" });
        if (r.ok){
          const j = await r.json();
          if (j && j.apiBase) return String(j.apiBase).replace(/\/+$/,"");
        }
      }catch {}

      throw new Error("API-bas kunde inte bestämmas. Ange ?api=… eller lägg en config.json med {\"apiBase\":\"https://…\"}.");
    }
    const API_PROMISE = resolveApiBase();
    const DEMO_WIDGET_BASE = "https://westjahlconsulting.github.io/ai-chatbot-frontend/";
    const DEMO_CUSTOMER_ID = "ceb2df2";

    // Sätt demo-iframe src när API-basen är känd
    (async () => {
      try{
        const API = await API_PROMISE;
        const iframe = document.getElementById("botjahl-demo");
        if (iframe) {
          iframe.src = `${DEMO_WIDGET_BASE}?customerId=${encodeURIComponent(DEMO_CUSTOMER_ID)}&api=${encodeURIComponent(API)}`;
        }
      }catch(err){
        console.warn("Kunde inte sätta demo-iframe:", err);
      }
    })();

    // Signup-hanterare
    document.getElementById('signup').addEventListener('submit', async (e) => {
      e.preventDefault();
      const f = e.target;

      // Normalisera websiteUrl så backend slipper ful-URL:er
      let url = f.websiteUrl.value.trim();
      if (!/^https?:\/\//i.test(url)) url = 'https://' + url;

      const body = {
        name: f.name.value.trim(),
        websiteUrl: url,
        email: f.email.value.trim()
      };

      const out = document.getElementById('signup-result');
      out.innerHTML = `<span class="muted">Skapar bot…</span>`;

      try{
        const API = await API_PROMISE;
        const res = await fetch(API + "/api/public/signup", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });
        const data = await res.json().catch(() => ({}));

        if (res.status === 409 && data.customerId) {
          // Företaget finns redan – visa ALDRIG snippet här.
          out.innerHTML = `
            <p><strong>Du verkar redan ha en bot.</strong> Kund-ID: <code>${data.customerId}</code></p>
            ${data.checkoutUrl ? `<p><a class="btn primary" href="${data.checkoutUrl}" target="_blank" rel="noopener">Fortsätt till Checkout</a></p>` : ""}
            <div class="grid grid-auto-2auto">
              <a class="btn secondary" href="success.html?cid=${encodeURIComponent(data.customerId)}">Hämta kodsnutt (efter betalning)</a>
              <a class="btn ghost" href="admin.html?cid=${encodeURIComponent(data.customerId)}">Öppna Admin</a>
            </div>
          `;
          return;
        }

        if (!res.ok) {
          out.innerHTML = `<p class="warn">Något gick fel. Testa igen.</p>`;
          return;
        }

        // 200 OK – ny kund. Visa bara checkout-länk + info.
        const cid = data.customerId;
        out.innerHTML = `
          <p><strong>Klart!</strong> Ditt kund-ID är <code>${cid}</code>.</p>
          ${data.checkoutUrl ? `<p><a class="btn primary" href="${data.checkoutUrl}" target="_blank" rel="noopener">Öppna Stripe Checkout</a></p>` :
            `<p class="warn">Kunde inte skapa Checkout-länk just nu. Försök igen om en stund.</p>`}
          <p class="muted">
            När du har lagt in betalmetod kan du hämta din kodsnutt här:
            <a href="success.html?cid=${encodeURIComponent(cid)}">success.html</a>
            eller ladda upp dokument i <a href="admin.html?cid=${encodeURIComponent(cid)}">Admin</a>.
          </p>
        `;
      }catch(err){
        out.innerHTML = `<p class="warn">Nätverksfel: ${err.message || "okänt fel"}</p>`;
      }
    });
  </script>
</body>
</html>
